<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa del Amor - Aventura Rom√°ntica</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Playfair Display', serif;
            background: black;
            min-height: 100vh;
            overflow-x: auto;
            position: relative;
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .title {
            text-align: center;
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: white;
            text-shadow: 
                2px 2px 4px rgba(0,0,0,0.4),
                0 0 10px rgba(184, 134, 11, 0.4),
                0 0 20px rgba(139, 69, 19, 0.2);
            margin-bottom: 20px;
            transform: rotate(-1deg);
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #8B4513;
            margin-bottom: 30px;
            font-style: italic;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .map-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            background-image: url("back.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 12px solid white;
            border-radius: 25px;
            box-shadow: 
                0 0 50px rgba(101, 67, 33, 0.6),
                inset 0 0 30px rgba(139, 69, 19, 0.2);
            padding: 40px;
            min-height: 600px;
            position: relative;
        }
        
        .map-container::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid #8B4513;
            border-radius: 20px;
            pointer-events: none;
            border-style: dashed;
        }
        
        .map-container::after {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 2.5rem;
            opacity: 0.7;
            transform: rotate(15deg);
        }
        
        .map-grid {
            position: relative;
            width: 100%;
            height: 600px;
            background: transparent;
        }
        
        .location {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                0 0 0 4px #8B4513,
                0 0 0 8px #A0522D;
            border: 3px solid #F5DEB3;
            opacity: 0.3;
            z-index: 10;
        }
        
        .location.locked {
            opacity: 0.3;
            cursor: not-allowed;
            background: linear-gradient(135deg, #696969, #808080) !important;
            box-shadow: 
                0 4px 10px rgba(0,0,0,0.2),
                0 0 0 4px #555555,
                0 0 0 8px #777777;
            border-color: #CCCCCC;
        }
        
        .location.locked:hover {
            transform: none;
            box-shadow: 
                0 4px 10px rgba(0,0,0,0.2),
                0 0 0 4px #555555,
                0 0 0 8px #777777;
        }
        
        .location.active {
            opacity: 1;
            animation: treasureGlow 2s infinite;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.4),
                0 0 0 4px #8B4513,
                0 0 0 8px #A0522D,
                0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .location.completed {
            opacity: 0.9;
            transform: scale(0.95);
            box-shadow: 
                0 6px 15px rgba(0,0,0,0.3),
                0 0 0 4px #228B22,
                0 0 0 8px #32CD32;
            border-color: #90EE90;
        }
        
        .location:hover.active {
            transform: scale(1.2);
            box-shadow: 
                0 12px 30px rgba(0,0,0,0.4),
                0 0 0 4px #8B4513,
                0 0 0 8px #A0522D,
                0 0 30px rgba(255, 215, 0, 0.8);
        }
        
        @keyframes treasureGlow {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.05);
                filter: brightness(1.2);
            }
        }
        

        
        .park {
            top: 52px;
            left: 497px;
            background: linear-gradient(135deg, #98FB98, #90EE90);
        }
        
        .cafe {
            top: 160px;
            left: 437px;
            background: linear-gradient(135deg, #DEB887, #F4A460);
        }
        
        .library {
            top: 262px;
            left: 210px;
            background: linear-gradient(135deg, #9370DB, #BA55D3);
        }
        
        .bridge {
            top: 364px;
            left: 312px;
            background: linear-gradient(135deg, #87CEEB, #B0E0E6);
        }
        
        .garden {
            top: 478px;
            left: 336px;
            background: linear-gradient(135deg, #8B4513, #CD853F);
        }
        
        .treasure-chest-final {
            animation: treasureVibrate 0.5s infinite, treasureGrow 2s ease-out forwards;
        }
        
        @keyframes treasureVibrate {
            0%, 100% { transform: translateX(0) scale(1.5); }
            25% { transform: translateX(-2px) scale(1.5); }
            50% { transform: translateX(2px) scale(1.5); }
            75% { transform: translateX(-1px) scale(1.5); }
        }
        
        @keyframes treasureGrow {
            0% { transform: scale(1); }
            100% { transform: scale(1.5); }
        }
        
        .surprise {
            top: 320px;
            left: 750px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .location.unlocking {
            animation: unlockAnimation 1.5s ease-in-out forwards;
        }
        
        @keyframes unlockAnimation {
            0% {
                transform: scale(1);
                opacity: 0.3;
            }
            25% {
                transform: scale(1.3) rotate(10deg);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.1) rotate(-5deg);
                opacity: 0.8;
            }
            75% {
                transform: scale(1.2) rotate(3deg);
                opacity: 0.9;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .unlock-particle {
            position: absolute;
            font-size: 1.2rem;
            color: #FFD700;
            animation: unlock-float 2s ease-out forwards;
            pointer-events: none;
            z-index: 15;
        }
        
        @keyframes unlock-float {
            0% {
                opacity: 1;
                transform: scale(0) translateY(0) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) translateY(-20px) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-50px) rotate(360deg);
            }
        }
        

        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #FFF0F5, #FFE4E1);
            margin: 3% auto;
            padding: 30px;
            border: 6px solid #D8537A;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 0 40px rgba(216, 83, 122, 0.4);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            color: #8B0045;
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            margin-bottom: 25px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .modal p {
            color: #4A4A4A;
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .challenge-text {
            background: rgba(255, 182, 193, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #FF69B4;
            font-weight: bold;
            color: #8B0045;
        }
        
        .quiz-container {
            display: none;
            margin: 20px 0;
        }
        
        .photo-challenge-container {
            display: none;
            margin: 20px 0;
        }
        
        .pose-card {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #FFB6C1;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
        }
        
        .pose-card.completed {
            border-color: #228B22;
            background: rgba(144, 238, 144, 0.2);
        }
        
        .pose-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .pose-image {
            width: 200px;
            height: 150px;
            margin: 15px auto;
            border: 3px solid #FFB6C1;
            border-radius: 15px;
            background: linear-gradient(135deg, #FFF0F5, #FFE4E1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(255, 182, 193, 0.3);
        }
        
        .pose-name {
            color: #8B0045;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: 'Dancing Script', cursive;
        }
        
        .pose-description {
            color: #4A4A4A;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .pose-tips {
            background: rgba(255, 182, 193, 0.2);
            padding: 12px;
            border-radius: 10px;
            font-style: italic;
            color: #8B0045;
            margin-bottom: 20px;
            border-left: 4px solid #FF69B4;
        }
        
        .pose-button {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.1rem;
            font-family: 'Playfair Display', serif;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .pose-button:hover {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            transform: translateY(-2px);
        }
        
        .pose-button.completed {
            background: linear-gradient(135deg, #90EE90, #98FB98);
            color: #006400;
        }
        
        .photo-progress {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            color: #8B0045;
            font-weight: bold;
        }
        
        .timer-challenge-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .timer-display {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .timer-circle {
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: bold;
            color: #8B0045;
            font-family: 'Dancing Script', cursive;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .timer-progress {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotate(-90deg);
        }
        
        .timer-instructions {
            background: rgba(255, 182, 193, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #FFB6C1;
        }
        
        .timer-instructions p {
            margin: 10px 0;
            font-size: 1.2rem;
            color: #8B0045;
            font-weight: bold;
        }
        
        .timer-buttons {
            margin: 20px 0;
        }
        
        .timer-btn {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2rem;
            font-family: 'Playfair Display', serif;
            font-weight: bold;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .timer-btn:hover {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .timer-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .question {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 2px solid #FFB6C1;
        }
        
        .question h3 {
            color: #8B0045;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .character-image-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .character-image {
            width: 200px;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            border: 4px solid #FFB6C1;
            box-shadow: 0 8px 20px rgba(255, 182, 193, 0.4);
            transition: all 0.3s ease;
        }
        
        .character-image:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(255, 182, 193, 0.6);
        }
        
        .option {
            display: block;
            margin: 10px 0;
            padding: 12px 20px;
            background: linear-gradient(135deg, #FFE4E1, #FFF0F5);
            border: 2px solid #FFB6C1;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            color: #8B0045;
        }
        
        .option:hover {
            background: linear-gradient(135deg, #FFB6C1, #FFC0CB);
            transform: translateX(5px);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border-color: #D8537A;
        }
        
        .option.correct {
            background: linear-gradient(135deg, #90EE90, #98FB98);
            border-color: #228B22;
            color: #006400;
        }
        
        .option.incorrect {
            background: linear-gradient(135deg, #FFB6C1, #FFA0B4);
            border-color: #DC143C;
            color: #8B0000;
        }
        
        .quiz-result {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .quiz-success {
            background: rgba(144, 238, 144, 0.3);
            color: #006400;
            border: 2px solid #228B22;
        }
        
        .quiz-failure {
            background: rgba(255, 182, 193, 0.3);
            color: #8B0000;
            border: 2px solid #DC143C;
        }
        
        .quiz-buttons {
            text-align: center;
            margin: 20px 0;
        }
        
        .quiz-btn {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.1rem;
            font-family: 'Playfair Display', serif;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .quiz-btn:hover {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            transform: translateY(-2px);
        }
        
        .quiz-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .close-btn {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2rem;
            font-family: 'Playfair Display', serif;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .close-btn:hover {
            background: linear-gradient(135deg, #FFB6C1, #FF69B4);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #D8537A;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4, #FFB6C1, #FF69B4);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 15px;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .heart-compass {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #CD853F, #DEB887);
            border-radius: 50%;
            border: 5px solid #8B4513;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: float 3s ease-in-out infinite;
            box-shadow: 
                0 4px 15px rgba(139, 69, 19, 0.4),
                inset 0 2px 4px rgba(255,255,255,0.2);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .celebration {
            animation: celebration 3s ease-in-out;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.4) rotate(15deg); }
            50% { transform: scale(1.6) rotate(-15deg); }
            75% { transform: scale(1.4) rotate(10deg); }
        }
        
        .heart-particle {
            position: absolute;
            font-size: 1.5rem;
            color: #FF69B4;
            animation: heart-float 2s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes heart-float {
            0% {
                opacity: 1;
                transform: scale(0) translateY(0);
            }
            50% {
                opacity: 1;
                transform: scale(1) translateY(-30px);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-80px);
            }
        }
        
        .step-counter {
            position: absolute;
            top: 40px;
            left: 20px;
            background: linear-gradient(135deg, #F5DEB3, #DEB887);
            padding: 15px 20px;
            border-radius: 20px;
            border: 3px solid #8B4513;
            font-weight: bold;
            color: #8B4513;
            font-size: 1.1rem;
            box-shadow: 
                0 4px 10px rgba(139, 69, 19, 0.3),
                inset 0 1px 2px rgba(255,255,255,0.2);
        }
        
        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .map-container {
                padding: 20px;
            }
            
            .map-grid {
                height: 400px;
            }
            
            .location {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }
            
            .heart-compass {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>

    
    <div class="container">
        <h1 class="title">üíï Primer Aniversario üíï</h1>
        
        <div class="map-container">
            <div class="heart-compass">üíñ</div>
            <div class="step-counter"><span id="currentStep">1</span> de 6</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="map-grid">
                <!-- Ubicaciones rom√°nticas en orden -->
                <div class="location park active" data-location="park" data-step="1" onclick="exploreLocation('park', 1)">
                    ‚ùì
                </div>
                
                <div class="location cafe locked" data-location="cafe" data-step="2" onclick="exploreLocation('cafe', 2)">
                    üîí
                </div>
                
                <div class="location library locked" data-location="library" data-step="3" onclick="exploreLocation('library', 3)">
                    üîí
                </div>
                
                <div class="location bridge locked" data-location="bridge" data-step="4" onclick="exploreLocation('bridge', 4)">
                    üîí
                </div>
                
                <div class="location garden locked" data-location="garden" data-step="5" onclick="exploreLocation('garden', 5)">
                    üîí
                </div>
                

            </div>
        </div>
    </div>
    
    <!-- Modal para mostrar desaf√≠os rom√°nticos -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <p id="modalText"></p>
            <div id="challengeText" class="challenge-text"></div>
            
            <!-- Quiz Container -->
            <div id="quizContainer" class="quiz-container">
                <div id="questionsContainer"></div>
                <div id="quizResult" class="quiz-result" style="display: none;"></div>
                <div class="quiz-buttons">
                    <button id="retryQuiz" class="quiz-btn" onclick="retryQuiz()" style="display: none;">Intentar de Nuevo</button>
                </div>
            </div>
            
            <!-- Photo Challenge Container -->
            <div id="photoChallengeContainer" class="photo-challenge-container">
                <div id="photoProgress" class="photo-progress"></div>
                <div id="posesContainer"></div>
                <div id="photoResult" class="quiz-result" style="display: none;"></div>
            </div>
            
            <!-- Timer Challenge Container -->
            <div id="timerChallengeContainer" class="timer-challenge-container" style="display: none;">
                <div class="timer-display">
                    <div class="timer-circle">
                        <div class="timer-text">
                            <span id="timerMinutes">01</span>:<span id="timerSeconds">00</span>
                        </div>
                        <svg class="timer-progress" width="200" height="200">
                            <circle cx="100" cy="100" r="90" stroke="#FFE4E1" stroke-width="8" fill="none"/>
                            <circle id="timerProgressCircle" cx="100" cy="100" r="90" stroke="#FF69B4" stroke-width="8" fill="none" 
                                    stroke-dasharray="565.48" stroke-dashoffset="565.48" transform="rotate(-90 100 100)"/>
                        </svg>
                    </div>
                </div>
                <div class="timer-instructions">
                    <p>üëÅÔ∏è Miraos fijamente a los ojos</p>
                    <p>ü§ê Sin hablar ni re√≠rse</p>
                    <p>üíï Conectad vuestras almas</p>
                </div>
                <div class="timer-buttons">
                    <button id="startTimerBtn" class="timer-btn" onclick="startTimer()">üöÄ ¬°Comenzar Desaf√≠o!</button>
                    <button id="resetTimerBtn" class="timer-btn" onclick="resetTimer()" style="display: none;">üîÑ Reintentar</button>
                </div>
                <div id="timerResult" class="quiz-result" style="display: none;"></div>
            </div>
            
            <button id="closeBtn" class="close-btn" onclick="closeModal()">¬°Desaf√≠o Completado! üíï</button>
        </div>
    </div>
    
    <script>
        let currentStep = 1;
        let completedSteps = [];
        let currentQuiz = null;
        let userAnswers = [];
        let quizPassed = false;
        let currentPhotoChallenge = null;
        let completedPoses = [];
        let photoChallengeCompleted = false;
        let currentTimerChallenge = null;
        let timerInterval = null;
        let timerCompleted = false;
        let remainingTime = 0;
        
        const romanticChallenges = {
            park: {
                title: "üå≥ El Parque de los Recuerdos",
                text: "Aqu√≠ comenz√≥ vuestra historia de amor. Este lugar guarda los secretos de vuestros primeros momentos juntos.",
                challenge: "DESAF√çO: Responde correctamente estas preguntas sobre nuestro primer beso para continuar la aventura rom√°ntica:",
                step: 1,
                isQuiz: true,
                questions: [
                    {
                        question: "¬øD√≥nde nos dimos nuestro primer beso?",
                        options: ["a. Coche", "b. Discoteca", "c. Jard√≠n"],
                        correct: 0 // √≠ndice de la respuesta correcta (coche = 0)
                    },
                    {
                        question: "¬øQu√© d√≠a de la semana fue?",
                        options: ["a. Lunes", "b. Martes", "c. Mi√©rcoles"],
                        correct: 0 // √≠ndice de la respuesta correcta (lunes = 0)
                    }
                ]
            },
            cafe: {
                title: "‚òï Caf√© de los Susurros",
                text: "El aroma del caf√© despierta memorias dulces. Aqu√≠ las palabras fluyen como el vapor de una taza caliente.",
                challenge: "DESAF√çO: ¬°Hora de crear recuerdos fotogr√°ficos! Imitad estas 3 poses rom√°nticas de parejas:",
                step: 2,
                isPhotoChallenge: true,
                poses: [
                    {
                        name: "Abrazo por la Espalda",
                        description: "Uno de vosotros abraza al otro por detr√°s, con las manos en la cintura. Mirad hacia el mismo lado con sonrisas naturales.",
                        emoji: "ü§ó",
                        tips: "Consejo: El que abraza debe apoyar suavemente la barbilla en el hombro del otro.",
                        imageSvg: `<svg width="160" height="120" viewBox="0 0 160 120" xmlns="http://www.w3.org/2000/svg">
                            <!-- Persona de atr√°s -->
                            <circle cx="90" cy="25" r="12" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="82" y="35" width="16" height="25" rx="8" fill="#FF69B4" stroke="#D8537A" stroke-width="2"/>
                            <rect x="78" y="60" width="8" height="20" rx="4" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="94" y="60" width="8" height="20" rx="4" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <!-- Brazos abrazando -->
                            <path d="M 82 45 Q 65 50 60 55 Q 58 58 62 60" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <path d="M 98 45 Q 115 50 120 55 Q 122 58 118 60" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <!-- Persona de adelante -->
                            <circle cx="80" cy="30" r="12" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="72" y="40" width="16" height="25" rx="8" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="68" y="65" width="8" height="20" rx="4" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="84" y="65" width="8" height="20" rx="4" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <!-- Corazones -->
                            <text x="40" y="25" font-size="12" fill="#FF69B4">üíï</text>
                            <text x="130" y="35" font-size="10" fill="#FF69B4">üíñ</text>
                        </svg>`
                    },
                    {
                        name: "Frente a Frente",
                        description: "Poneos frente a frente, muy cerca. Tocad vuestras frentes y cerrad los ojos. Las manos pueden estar en las mejillas del otro.",
                        emoji: "üíï",
                        tips: "Consejo: Respirad profundo y disfrutad del momento √≠ntimo antes de la foto.",
                        imageSvg: `<svg width="160" height="120" viewBox="0 0 160 120" xmlns="http://www.w3.org/2000/svg">
                            <!-- Persona izquierda -->
                            <circle cx="60" cy="35" r="15" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="50" y="48" width="20" height="30" rx="10" fill="#FF69B4" stroke="#D8537A" stroke-width="2"/>
                            <rect x="45" y="78" width="10" height="25" rx="5" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="65" y="78" width="10" height="25" rx="5" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <!-- Persona derecha -->
                            <circle cx="100" cy="35" r="15" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="90" y="48" width="20" height="30" rx="10" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="85" y="78" width="10" height="25" rx="5" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="105" y="78" width="10" height="25" rx="5" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <!-- Brazos tocando mejillas -->
                            <path d="M 70 55 Q 85 45 95 40" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <path d="M 90 55 Q 75 45 65 40" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <!-- L√≠nea conectando frentes -->
                            <line x1="75" y1="35" x2="85" y2="35" stroke="#FF69B4" stroke-width="2" stroke-dasharray="3,3"/>
                            <!-- Corazones flotando -->
                            <text x="75" y="20" font-size="14" fill="#FF69B4">üíï</text>
                            <text x="30" y="40" font-size="10" fill="#FF69B4">üíñ</text>
                            <text x="120" y="50" font-size="10" fill="#FF69B4">üíó</text>
                        </svg>`
                    },
                    {
                        name: "Baile Rom√°ntico",
                        description: "Posici√≥n de baile cl√°sico: una mano en la cintura, la otra entrelazada. Miradas conectadas y sonrisas genuinas.",
                        emoji: "üíÉ",
                        tips: "Consejo: Imaginad que est√°is bailando vuestra canci√≥n favorita.",
                        imageSvg: `<svg width="160" height="120" viewBox="0 0 160 120" xmlns="http://www.w3.org/2000/svg">
                            <!-- Persona izquierda (l√≠der) -->
                            <circle cx="65" cy="30" r="12" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="57" y="40" width="16" height="28" rx="8" fill="#FF69B4" stroke="#D8537A" stroke-width="2"/>
                            <rect x="53" y="68" width="8" height="22" rx="4" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="69" y="68" width="8" height="22" rx="4" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <!-- Persona derecha -->
                            <circle cx="95" cy="30" r="12" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="87" y="40" width="16" height="28" rx="8" fill="#FFB6C1" stroke="#D8537A" stroke-width="2"/>
                            <rect x="83" y="68" width="8" height="22" rx="4" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <rect x="99" y="68" width="8" height="22" rx="4" fill="#FFC0CB" stroke="#D8537A" stroke-width="2"/>
                            <!-- Manos entrelazadas arriba -->
                            <circle cx="80" cy="35" r="4" fill="#FF69B4" stroke="#D8537A" stroke-width="2"/>
                            <path d="M 73 42 Q 80 35 87 42" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <!-- Mano en la cintura -->
                            <path d="M 57 50 Q 75 55 87 52" fill="none" stroke="#D8537A" stroke-width="3" stroke-linecap="round"/>
                            <!-- Notas musicales -->
                            <text x="40" y="25" font-size="12" fill="#FF69B4">‚ô™</text>
                            <text x="115" y="35" font-size="10" fill="#FF69B4">‚ô´</text>
                            <text x="45" y="70" font-size="8" fill="#FF69B4">‚ô™</text>
                            <!-- Corazones -->
                            <text x="80" y="15" font-size="12" fill="#FF69B4">üíï</text>
                            <text x="120" y="60" font-size="10" fill="#FF69B4">üíñ</text>
                        </svg>`
                    }
                ]
            },
            library: {
                title: "üìö Biblioteca de los Sue√±os",
                text: "Entre p√°ginas y susurros, los sue√±os cobran vida. En esta biblioteca m√°gica, las historias √©picas cobran vida.",
                challenge: "DESAF√çO: ¬°Demuestra tu conocimiento de Juego de Tronos! Identifica correctamente estos 3 personajes para continuar:",
                step: 3,
                isQuiz: true,
                questions: [
                    {
                        question: "¬øQui√©n es este personaje?",
                        character: "Jon Snow",
                        imageUrl: "TU_URL_AQUI_JON_SNOW",
                        options: ["a. Jon Snow", "b. Robb Stark", "c. Ned Stark"],
                        correct: 0
                    },
                    {
                        question: "¬øQui√©n es esta personaje?",
                        character: "Daenerys Targaryen",
                        imageUrl: "TU_URL_AQUI_DAENERYS",
                        options: ["a. Cersei Lannister", "b. Daenerys Targaryen", "c. Sansa Stark"],
                        correct: 1
                    },
                    {
                        question: "¬øQui√©n es este personaje?",
                        character: "Tyrion Lannister",
                        imageUrl: "TU_URL_AQUI_TYRION",
                        options: ["a. Jaime Lannister", "b. Tyrion Lannister", "c. Tywin Lannister"],
                        correct: 1
                    }
                ]
            },
            footballQuiz: {
                title: "Eyyy no tan r√°pido...",
                text: "Antes de continuar, una pregunta importante que definir√° nuestro futuro. Piensa bien...",
                challenge: "¬øCu√°l es el mejor equipo del mundo?",
                step: 3.5,
                isQuiz: true,
                questions: [
                    {
                        question: "¬øCu√°l es el mejor equipo del mundo?",
                        options: ["a. Real Madrid (ESTA NO ES)", "b. Atl√©tico de Madrid (ES ESTAAAA)"],
                        correct: 1 // Atl√©tico de Madrid es la respuesta correcta
                    }
                ]
            },

            bridge: {
                title: "üåâ Puente de las Promesas",
                text: "Este puente conecta no solo dos orillas, sino dos corazones. Aqu√≠ las promesas se vuelven eternas.",
                challenge: "DESAF√çO: Miraos fijamente a los ojos durante 1 minuto completo sin re√≠ros ni decir nada. ¬°La conexi√≥n m√°s profunda!",
                step: 4,
                isTimerChallenge: true,
                timerDuration: 60 // 60 segundos
            },
            garden: {
                title: "üè¥‚Äç‚ò†Ô∏è El Cofre del Tesoro Final",
                text: "¬°Hab√©is llegado al cofre del tesoro m√°s preciado! Este ba√∫l pirata guarda el secreto final de vuestra aventura rom√°ntica.",
                challenge: "DESAF√çO FINAL: ¬°Felicidades! Hab√©is completado todos los retos. Ahora abrid el cofre y descubrid el √∫ltimo secreto que os espera...",
                step: 5
            },
            surprise: {
                title: "üíù ¬°La Sorpresa Final!",
                text: "¬°Felicidades, pareja aventurera! Hab√©is completado el mapa del amor y demostrado que vuestro amor puede superar cualquier desaf√≠o.",
                challenge: "RECOMPENSA FINAL: ¬°Aqu√≠ est√° vuestra sorpresa especial! (Aqu√≠ puedes poner tu sorpresa real: una cena, un regalo, un viaje, etc.) ¬°Hab√©is ganado una noche m√°gica juntos! üéâ‚ú®",
                step: 6,
                isFinal: true
            }
        };
        
        function exploreLocation(locationName, step) {
            const locationElement = document.querySelector(`[data-location="${locationName}"]`);
            
            // Verificar si est√° bloqueado
            if (locationElement.classList.contains('locked')) {
                showLockedMessage();
                return;
            }
            
            // Solo permitir el paso actual
            if (step !== currentStep) {
                if (step < currentStep) {
                    // Ya completado
                    return;
                } else {
                    // Mostrar mensaje de que debe completar pasos anteriores
                    alert("¬°Debes completar los desaf√≠os en orden! üíï");
                    return;
                }
            }
            
            const challenge = romanticChallenges[locationName];
            
            // Mostrar modal con desaf√≠o
            document.getElementById('modalTitle').textContent = challenge.title;
            document.getElementById('modalText').textContent = challenge.text;
            document.getElementById('challengeText').textContent = challenge.challenge;
            
            // Si es un quiz, configurarlo
            if (challenge.isQuiz) {
                setupQuiz(challenge);
                document.getElementById('closeBtn').style.display = 'none';
                document.getElementById('photoChallengeContainer').style.display = 'none';
            } else if (challenge.isPhotoChallenge) {
                setupPhotoChallenge(challenge);
                document.getElementById('closeBtn').style.display = 'none';
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('timerChallengeContainer').style.display = 'none';
            } else if (challenge.isTimerChallenge) {
                setupTimerChallenge(challenge);
                document.getElementById('closeBtn').style.display = 'none';
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('photoChallengeContainer').style.display = 'none';
            } else {
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('photoChallengeContainer').style.display = 'none';
                document.getElementById('timerChallengeContainer').style.display = 'none';
                document.getElementById('closeBtn').style.display = 'block';
                // Completar inmediatamente para desaf√≠os normales
                completeChallenge(locationName, step);
            }
            
            document.getElementById('modal').style.display = 'block';
        }
        
        function setupQuiz(challenge) {
            currentQuiz = challenge;
            userAnswers = [];
            quizPassed = false;
            currentQuiz.currentQuestionIndex = 0;
            
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('quizResult').style.display = 'none';
            document.getElementById('retryQuiz').style.display = 'none';
            
            showCurrentQuestion();
        }
        
        function showCurrentQuestion() {
            const questionsContainer = document.getElementById('questionsContainer');
            questionsContainer.innerHTML = '';
            
            const currentIndex = currentQuiz.currentQuestionIndex;
            const q = currentQuiz.questions[currentIndex];
            
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.innerHTML = `
                <h3>Pregunta ${currentIndex + 1} de ${currentQuiz.questions.length}</h3>
                <h3>${q.question}</h3>
                ${q.imageUrl ? `
                    <div class="character-image-container">
                        <img src="${q.imageUrl}" alt="${q.character}" class="character-image" />
                    </div>
                ` : ''}
                ${q.options.map((option, optIndex) => `
                    <div class="option" onclick="selectQuizOption(${optIndex})" data-option="${optIndex}">
                        ${option}
                    </div>
                `).join('')}
            `;
            questionsContainer.appendChild(questionDiv);
        }
        
        function selectQuizOption(optionIndex) {
            const currentIndex = currentQuiz.currentQuestionIndex;
            const correctAnswer = currentQuiz.questions[currentIndex].correct;
            
            // Guardar respuesta
            userAnswers[currentIndex] = optionIndex;
            
            // Marcar la opci√≥n seleccionada
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.classList.remove('selected');
            });
            
            const selectedOption = document.querySelector(`[data-option="${optionIndex}"]`);
            selectedOption.classList.add('selected');
            
            // Esperar un momento y luego proceder
            setTimeout(() => {
                if (optionIndex === correctAnswer) {
                    // Respuesta correcta
                    selectedOption.classList.add('correct');
                    setTimeout(() => {
                        proceedToNextQuestion();
                    }, 1500);
                } else {
                    // Respuesta incorrecta
                    selectedOption.classList.add('incorrect');
                    setTimeout(() => {
                        showIncorrectMessage();
                    }, 1500);
                }
            }, 500);
        }
        
        function proceedToNextQuestion() {
            currentQuiz.currentQuestionIndex++;
            
            if (currentQuiz.currentQuestionIndex >= currentQuiz.questions.length) {
                // Todas las preguntas respondidas correctamente
                showQuizSuccess();
            } else {
                // Mostrar siguiente pregunta
                showCurrentQuestion();
            }
        }
        
        function showIncorrectMessage() {
            const resultDiv = document.getElementById('quizResult');
            resultDiv.className = 'quiz-result quiz-failure';
            resultDiv.textContent = '¬°Ups! üíî Esa respuesta no es correcta. ¬°Int√©ntalo de nuevo!';
            resultDiv.style.display = 'block';
            document.getElementById('retryQuiz').style.display = 'inline-block';
        }
        
        function showQuizSuccess() {
            const resultDiv = document.getElementById('quizResult');
            resultDiv.className = 'quiz-result quiz-success';
            
            // Mensaje especial para la pregunta de f√∫tbol
            if (currentQuiz.step === 3.5) {
                resultDiv.innerHTML = `
                    <div style="text-align: center;">
                        <h3 style="color: #8B0045; margin-bottom: 20px; font-family: 'Dancing Script', cursive; font-size: 2rem;">
                            ¬°MUY BIEN AMOR! üî¥‚ö™
                        </h3>
                        <div style="margin: 20px 0;">
                            <img src="atm.png" alt="Atl√©tico de Madrid" style="max-width: 300px; height: auto; border-radius: 15px; border: 4px solid #D8537A; box-shadow: 0 8px 20px rgba(216, 83, 122, 0.4);" />
                        </div>
                        <p style="color: #8B0045; font-size: 1.3rem; font-weight: bold; margin: 15px 0;">
                            Ya sab√≠a yo que pod√≠a confiar en ti... üíï
                        </p>
                    </div>
                `;
            } else {
                resultDiv.textContent = '¬°Perfecto! üíï Todas las respuestas son correctas. ¬°Puedes continuar con la aventura!';
            }
            
            resultDiv.style.display = 'block';
            quizPassed = true;
            document.getElementById('closeBtn').style.display = 'block';
            document.getElementById('closeBtn').textContent = '¬°Continuar Aventura! üíï';
            
            // Ocultar el contenedor de preguntas
            document.getElementById('questionsContainer').innerHTML = '';
        }
        
        function retryQuiz() {
            // Resetear el quiz
            userAnswers = [];
            currentQuiz.currentQuestionIndex = 0;
            
            document.getElementById('quizResult').style.display = 'none';
            document.getElementById('retryQuiz').style.display = 'none';
            document.getElementById('closeBtn').style.display = 'none';
            
            // Mostrar la primera pregunta de nuevo
            showCurrentQuestion();
        }
        
        function setupPhotoChallenge(challenge) {
            currentPhotoChallenge = challenge;
            completedPoses = [];
            photoChallengeCompleted = false;
            
            document.getElementById('photoChallengeContainer').style.display = 'block';
            document.getElementById('photoResult').style.display = 'none';
            
            showPhotoPoses();
        }
        
        function showPhotoPoses() {
            const posesContainer = document.getElementById('posesContainer');
            const progressDiv = document.getElementById('photoProgress');
            
            progressDiv.textContent = `Poses completadas: ${completedPoses.length} de ${currentPhotoChallenge.poses.length}`;
            
            posesContainer.innerHTML = '';
            
            currentPhotoChallenge.poses.forEach((pose, index) => {
                const isCompleted = completedPoses.includes(index);
                
                const poseCard = document.createElement('div');
                poseCard.className = `pose-card ${isCompleted ? 'completed' : ''}`;
                poseCard.innerHTML = `
                    <span class="pose-emoji">${pose.emoji}</span>
                    <div class="pose-name">${pose.name}</div>
                    <div class="pose-image">
                        ${pose.imageSvg}
                    </div>
                    <div class="pose-description">${pose.description}</div>
                    <div class="pose-tips">${pose.tips}</div>
                    <button class="pose-button ${isCompleted ? 'completed' : ''}" 
                            onclick="completePose(${index})" 
                            ${isCompleted ? 'disabled' : ''}>
                        ${isCompleted ? '‚úÖ ¬°Completada!' : 'üì∏ ¬°Foto Tomada!'}
                    </button>
                `;
                posesContainer.appendChild(poseCard);
            });
        }
        
        function completePose(poseIndex) {
            if (!completedPoses.includes(poseIndex)) {
                completedPoses.push(poseIndex);
                
                // Crear efecto de corazones
                const poseCard = document.querySelectorAll('.pose-card')[poseIndex];
                createHeartParticles(poseCard);
                
                // Actualizar la vista
                showPhotoPoses();
                
                // Verificar si todas las poses est√°n completadas
                if (completedPoses.length === currentPhotoChallenge.poses.length) {
                    setTimeout(() => {
                        showPhotoChallengeSuccess();
                    }, 1000);
                }
            }
        }
        
        function showPhotoChallengeSuccess() {
            const resultDiv = document.getElementById('photoResult');
            resultDiv.className = 'quiz-result quiz-success';
            resultDiv.textContent = '¬°Fant√°stico! üì∏üíï Hab√©is completado todas las poses rom√°nticas. ¬°Qu√© recuerdos tan hermosos hab√©is creado!';
            resultDiv.style.display = 'block';
            photoChallengeCompleted = true;
            document.getElementById('closeBtn').style.display = 'block';
            document.getElementById('closeBtn').textContent = '¬°Continuar Aventura! üíï';
            
            // Ocultar las poses
            document.getElementById('posesContainer').innerHTML = '';
            document.getElementById('photoProgress').style.display = 'none';
        }
        
        function setupTimerChallenge(challenge) {
            currentTimerChallenge = challenge;
            timerCompleted = false;
            remainingTime = challenge.timerDuration;
            
            document.getElementById('timerChallengeContainer').style.display = 'block';
            document.getElementById('timerResult').style.display = 'none';
            document.getElementById('startTimerBtn').style.display = 'inline-block';
            document.getElementById('resetTimerBtn').style.display = 'none';
            
            // Resetear el timer visual
            updateTimerDisplay();
            resetTimerProgress();
        }
        
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            remainingTime = currentTimerChallenge.timerDuration;
            document.getElementById('startTimerBtn').disabled = true;
            document.getElementById('startTimerBtn').textContent = '‚è≥ En progreso...';
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                updateTimerProgress();
                
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    showTimerSuccess();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            
            document.getElementById('timerMinutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('timerSeconds').textContent = seconds.toString().padStart(2, '0');
        }
        
        function updateTimerProgress() {
            const totalTime = currentTimerChallenge.timerDuration;
            const progress = (totalTime - remainingTime) / totalTime;
            const circumference = 2 * Math.PI * 90; // radio = 90
            const offset = circumference - (progress * circumference);
            
            document.getElementById('timerProgressCircle').style.strokeDashoffset = offset;
        }
        
        function resetTimerProgress() {
            const circumference = 2 * Math.PI * 90;
            document.getElementById('timerProgressCircle').style.strokeDashoffset = circumference;
        }
        
        function resetTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            remainingTime = currentTimerChallenge.timerDuration;
            updateTimerDisplay();
            resetTimerProgress();
            
            document.getElementById('startTimerBtn').disabled = false;
            document.getElementById('startTimerBtn').textContent = 'üöÄ ¬°Comenzar Desaf√≠o!';
            document.getElementById('startTimerBtn').style.display = 'inline-block';
            document.getElementById('resetTimerBtn').style.display = 'none';
            document.getElementById('timerResult').style.display = 'none';
        }
        
        function showTimerSuccess() {
            const resultDiv = document.getElementById('timerResult');
            resultDiv.className = 'quiz-result quiz-success';
            resultDiv.innerHTML = `
                <div style="text-align: center;">
                    <h3 style="color: #8B0045; margin-bottom: 15px; font-family: 'Dancing Script', cursive; font-size: 2rem;">
                        ¬°INCRE√çBLE! üëÅÔ∏èüíï
                    </h3>
                    <p style="color: #8B0045; font-size: 1.3rem; margin: 15px 0;">
                        ¬°Hab√©is logrado mantener la conexi√≥n visual durante un minuto completo!
                    </p>
                    <p style="color: #4A4A4A; font-size: 1.1rem;">
                        Vuestra conexi√≥n es tan profunda que el tiempo se detiene cuando os mir√°is. üíñ
                    </p>
                </div>
            `;
            resultDiv.style.display = 'block';
            timerCompleted = true;
            
            document.getElementById('closeBtn').style.display = 'block';
            document.getElementById('closeBtn').textContent = '¬°Continuar Aventura! üíï';
            document.getElementById('startTimerBtn').style.display = 'none';
            document.getElementById('resetTimerBtn').style.display = 'inline-block';
            
            // Crear efecto de corazones
            const timerContainer = document.getElementById('timerChallengeContainer');
            createHeartParticles(timerContainer);
        }
        
        function completeChallenge(locationName, step) {
            // Marcar como completado
            completedSteps.push(step);
            const locationElement = document.querySelector(`[data-location="${locationName}"]`);
            locationElement.classList.remove('active');
            locationElement.classList.add('completed');
            
            // Actualizar progreso
            updateProgress();
            
            // Activar siguiente ubicaci√≥n
            if (step < 6) {
                activateNextLocation(step + 1);
            }
            
            // Si es el √∫ltimo desaf√≠o (garden/tesoro), mostrar mensaje final
            if (locationName === 'garden' && step === 5) {
                // Hacer que el ba√∫l del tesoro crezca y vibre
                locationElement.classList.add('treasure-chest-final');
                setTimeout(() => {
                    showFinalCompletionMessage();
                }, 1000);
            }
            
            // Efectos especiales
            const challenge = romanticChallenges[locationName];
            if (challenge.isFinal) {
                celebrateFinalSurprise(locationElement);
            } else {
                createHeartParticles(locationElement);
            }
        }
        
        function updateProgress() {
            const progress = (completedSteps.length / 6) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = currentStep + 1;
            currentStep++;
        }
        
        function activateNextLocation(nextStep) {
            if (nextStep <= 6) {
                const nextLocation = document.querySelector(`[data-step="${nextStep}"]`);
                if (nextLocation && nextLocation.classList.contains('locked')) {
                    // Animar el desbloqueo
                    unlockLocation(nextLocation, nextStep);
                }
            }
        }
        
        function unlockLocation(locationElement, step) {
            // Crear part√≠culas de desbloqueo
            createUnlockParticles(locationElement);
            
            // Animar el desbloqueo
            locationElement.classList.add('unlocking');
            
            setTimeout(() => {
                // Remover clases de bloqueo y a√±adir activo
                locationElement.classList.remove('locked', 'unlocking');
                locationElement.classList.add('active');
                
                // Cambiar el icono seg√∫n el paso
                const icons = {
                    2: 'üì∑', // cafe
                    3: 'üé¨', // library
                    4: 'üë•', // bridge
                    5: 'üè¥‚Äç‚ò†Ô∏è' // garden
                };
                
                if (icons[step]) {
                    locationElement.textContent = icons[step];
                }
                
                // Efecto de brillo final
                setTimeout(() => {
                    createHeartParticles(locationElement);
                }, 500);
                
            }, 1500);
        }
        
        function createUnlockParticles(element) {
            const particles = ['üîì', '‚ú®', 'üí´', '‚≠ê', 'üåü'];
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'unlock-particle';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                
                const rect = element.getBoundingClientRect();
                const containerRect = element.parentElement.getBoundingClientRect();
                
                // Posicionar alrededor del elemento
                const angle = (i / 8) * 2 * Math.PI;
                const radius = 40;
                const x = (rect.left - containerRect.left) + (rect.width / 2) + Math.cos(angle) * radius;
                const y = (rect.top - containerRect.top) + (rect.height / 2) + Math.sin(angle) * radius;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                element.parentElement.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentElement) {
                        particle.remove();
                    }
                }, 2000);
            }
        }
        
        function showLockedMessage() {
            // Crear modal temporal para mensaje de bloqueo
            const lockedModal = document.createElement('div');
            lockedModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 1500;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            lockedModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #FFF0F5, #FFE4E1);
                    padding: 30px;
                    border-radius: 20px;
                    text-align: center;
                    max-width: 400px;
                    width: 90%;
                    border: 4px solid #D8537A;
                    box-shadow: 0 0 30px rgba(216, 83, 122, 0.4);
                ">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üîí</div>
                    <h2 style="
                        font-family: 'Dancing Script', cursive;
                        font-size: 2rem;
                        color: #8B0045;
                        margin-bottom: 20px;
                    ">¬°Ubicaci√≥n Bloqueada!</h2>
                    <p style="
                        color: #4A4A4A;
                        font-size: 1.2rem;
                        margin-bottom: 25px;
                        line-height: 1.5;
                    ">Debes completar el desaf√≠o anterior para desbloquear esta ubicaci√≥n rom√°ntica üíï</p>
                    <button onclick="closeLockedMessage()" style="
                        background: linear-gradient(135deg, #FF69B4, #FFB6C1);
                        color: white;
                        border: none;
                        padding: 12px 25px;
                        border-radius: 20px;
                        font-size: 1.1rem;
                        font-family: 'Playfair Display', serif;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">¬°Entendido! üíñ</button>
                </div>
            `;
            
            document.body.appendChild(lockedModal);
            
            // Funci√≥n global para cerrar el mensaje
            window.closeLockedMessage = function() {
                lockedModal.remove();
                delete window.closeLockedMessage;
            };
            
            // Auto-cerrar despu√©s de 3 segundos
            setTimeout(() => {
                if (document.body.contains(lockedModal)) {
                    lockedModal.remove();
                    delete window.closeLockedMessage;
                }
            }, 3000);
        }
        
        // Los senderos ya est√°n visibles en el mapa
        
        function celebrateFinalSurprise(element) {
            element.classList.add('celebration');
            
            // Crear muchos corazones
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createHeartParticles(element);
                }, i * 150);
            }
        }
        
        function showFootballQuiz() {
            const footballChallenge = romanticChallenges.footballQuiz;
            
            // Actualizar el contenido del modal
            document.getElementById('modalTitle').textContent = footballChallenge.title;
            document.getElementById('modalText').textContent = footballChallenge.text;
            document.getElementById('challengeText').textContent = footballChallenge.challenge;
            
            // Configurar el quiz de f√∫tbol
            setupQuiz(footballChallenge);
        }
        
        function showFinalCompletionMessage() {
            // Crear modal especial para el mensaje final
            const finalModal = document.createElement('div');
            finalModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            finalModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #FFF0F5, #FFE4E1);
                    padding: 40px;
                    border-radius: 25px;
                    text-align: center;
                    max-width: 600px;
                    width: 90%;
                    border: 6px solid #D8537A;
                    box-shadow: 0 0 50px rgba(216, 83, 122, 0.6);
                    animation: finalGlow 2s infinite alternate;
                ">
                    <h1 style="
                        font-family: 'Dancing Script', cursive;
                        font-size: 3rem;
                        color: #8B0045;
                        margin-bottom: 30px;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                    ">¬°ENHORABUENA! üéâ</h1>
                    
                    <div style="margin: 30px 0;">
                        <div style="
                            width: 200px;
                            height: 200px;
                            margin: 0 auto 20px;
                            border-radius: 20px;
                            background: linear-gradient(135deg, #8B4513, #CD853F);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 5rem;
                            border: 8px solid #D8537A;
                            box-shadow: 0 0 30px rgba(139, 69, 19, 0.6);
                            animation: treasureRotate 3s linear infinite;
                        ">üè¥‚Äç‚ò†Ô∏è</div>
                    </div>
                    
                    <p style="
                        font-size: 1.5rem;
                        color: #8B0045;
                        margin: 25px 0;
                        font-weight: bold;
                        line-height: 1.6;
                    ">¬°Hab√©is completado toda la aventura rom√°ntica!</p>
                    
                    <div style="
                        background: rgba(255, 182, 193, 0.3);
                        padding: 25px;
                        border-radius: 20px;
                        margin: 30px 0;
                        border: 3px solid #FF69B4;
                    ">
                        <p style="
                            font-size: 1.8rem;
                            color: #8B0045;
                            font-weight: bold;
                            margin-bottom: 15px;
                            font-family: 'Dancing Script', cursive;
                        ">üíù MENSAJE FINAL üíù</p>
                        <p style="
                            font-size: 1.3rem;
                            color: #4A4A4A;
                            line-height: 1.6;
                        "><strong>Mira en tu bolso,<br>ah√≠ ser√° donde guard√©<br>el √∫ltimo secreto</strong> üéÅ</p>
                    </div>
                    
                    <button onclick="closeFinalMessage()" style="
                        background: linear-gradient(135deg, #FF69B4, #FFB6C1);
                        color: white;
                        border: none;
                        padding: 20px 40px;
                        border-radius: 30px;
                        font-size: 1.3rem;
                        font-family: 'Playfair Display', serif;
                        font-weight: bold;
                        cursor: pointer;
                        box-shadow: 0 6px 15px rgba(0,0,0,0.3);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                        ¬°Gracias por esta aventura! üíï
                    </button>
                </div>
            `;
            
            document.body.appendChild(finalModal);
            
            // A√±adir estilos de animaci√≥n
            const style = document.createElement('style');
            style.textContent = `
                @keyframes finalGlow {
                    0% { box-shadow: 0 0 50px rgba(216, 83, 122, 0.6); }
                    100% { box-shadow: 0 0 80px rgba(216, 83, 122, 0.9); }
                }
                @keyframes treasureRotate {
                    0% { transform: rotate(0deg) scale(1); }
                    50% { transform: rotate(180deg) scale(1.1); }
                    100% { transform: rotate(360deg) scale(1); }
                }
            `;
            document.head.appendChild(style);
            
            // Funci√≥n global para cerrar el mensaje final
            window.closeFinalMessage = function() {
                finalModal.remove();
                style.remove();
            };
        }
        
        function createHeartParticles(element) {
            const hearts = ['üíï', 'üíñ', 'üíó', 'üíò', 'üíù'];
            
            for (let i = 0; i < 3; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart-particle';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                
                const rect = element.getBoundingClientRect();
                const containerRect = element.parentElement.getBoundingClientRect();
                
                heart.style.left = (rect.left - containerRect.left + Math.random() * 70) + 'px';
                heart.style.top = (rect.top - containerRect.top + Math.random() * 70) + 'px';
                
                element.parentElement.appendChild(heart);
                
                setTimeout(() => {
                    heart.remove();
                }, 2000);
            }
        }
        
        function closeModal() {
            // Solo cerrar si no hay desaf√≠os activos o si fueron completados
            if ((!currentQuiz || quizPassed) && (!currentPhotoChallenge || photoChallengeCompleted) && (!currentTimerChallenge || timerCompleted)) {
                if (currentQuiz && quizPassed) {
                    // Completar el desaf√≠o del quiz seg√∫n la ubicaci√≥n
                    if (currentQuiz.step === 1) {
                        completeChallenge('park', 1);
                    } else if (currentQuiz.step === 3) {
                        // Despu√©s del quiz de la biblioteca, mostrar la pregunta de f√∫tbol
                        completeChallenge('library', 3);
                        setTimeout(() => {
                            showFootballQuiz();
                        }, 500);
                        return; // No cerrar el modal todav√≠a
                    } else if (currentQuiz.step === 3.5) {
                        // Completar la pregunta de f√∫tbol y continuar
                        currentQuiz = null;
                        quizPassed = false;
                    }
                    currentQuiz = null;
                    quizPassed = false;
                }
                if (currentPhotoChallenge && photoChallengeCompleted) {
                    // Completar el desaf√≠o de fotos
                    completeChallenge('cafe', 2);
                    currentPhotoChallenge = null;
                    photoChallengeCompleted = false;
                    completedPoses = [];
                }
                if (currentTimerChallenge && timerCompleted) {
                    // Completar el desaf√≠o del timer
                    completeChallenge('bridge', 4);
                    currentTimerChallenge = null;
                    timerCompleted = false;
                    if (timerInterval) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                    }
                }
                document.getElementById('modal').style.display = 'none';
            }
        }
        
        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
        // Animaci√≥n de entrada
        window.addEventListener('load', function() {
            const locations = document.querySelectorAll('.location');
            locations.forEach((location, index) => {
                setTimeout(() => {
                    location.style.transform = 'scale(1)';
                }, index * 300);
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a81928369903c7',t:'MTc1NDQxNTgyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
